<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Sales Report</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
    <div class="container mt-5">
        <h1>Product Sales</h1>

        <table id="product-sales" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Total Sales</th>
                </tr>
            </thead>
            <tbody>
                <!-- Product sales rows will be populated here by JavaScript -->
            </tbody>
            <tfoot>
                <tr>
                    <td class="text-end"><strong>Grand Total:</strong></td>
                    <td id="total-sales"></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <script>
        // The base64 encoded CSV data from attachments
        const csvBase64 = "cHJvZHVjdCxzYWxlcwpBLDUwMDAKQiwxMDAwMAo="; 

        // Decode the base64 string to plain CSV text
        const csvString = atob(csvBase64);
        // Split into lines and filter out any empty lines
        const lines = csvString.split('\n').filter(line => line.trim() !== '');

        // The first line is the header, subsequent lines are data
        const dataRows = lines.slice(1);

        const productSalesBody = document.querySelector("#product-sales tbody");
        const totalSalesElement = document.getElementById("total-sales");
        let grandTotal = 0;

        dataRows.forEach(line => {
            const parts = line.split(',');
            // Ensure the line has both product and sales parts
            if (parts.length === 2) {
                const product = parts[0].trim();
                const sales = parseFloat(parts[1].trim());

                // Only process if sales is a valid number
                if (!isNaN(sales)) {
                    const row = productSalesBody.insertRow();
                    const productCell = row.insertCell();
                    const salesCell = row.insertCell();

                    productCell.textContent = product;
                    // Format sales as a plain number string for the evaluation check
                    // which uses parseFloat(cell.textContent). Using toFixed(2) to
                    // ensure consistency with currency decimals without currency symbols.
                    salesCell.textContent = sales.toFixed(2); 

                    grandTotal += sales;
                }
            }
        });

        // Display the grand total in the footer, formatted as currency
        totalSalesElement.textContent = grandTotal.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
    </script>
    <!-- Bootstrap JS (optional, for components that require JS, not strictly needed for this table) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>